{"schemaVersion":{"patch":0,"minor":3,"major":0},"hierarchy":{"paths":[["doc:\/\/BedrockService\/documentation\/BedrockService"]]},"sections":[],"seeAlsoSections":[{"anchor":"Related-Documentation","identifiers":["https:\/\/docs.aws.amazon.com\/bedrock\/latest\/userguide\/model-parameters.html","https:\/\/docs.aws.amazon.com\/bedrock\/latest\/userguide\/conversation-inference-supported-models-features.html"],"title":"Related Documentation"}],"identifier":{"url":"doc:\/\/BedrockService\/documentation\/BedrockService\/AddingModels","interfaceLanguage":"swift"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/bedrockservice\/addingmodels"]}],"primaryContentSections":[{"content":[{"level":2,"type":"heading","anchor":"Overview","text":"Overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"BedrockService is designed to be extensible. You can add support for new foundation models by implementing the appropriate modality protocols and creating BedrockModel instances."}]},{"level":2,"type":"heading","anchor":"Adding-Converse-Only-Models","text":"Adding Converse-Only Models"},{"type":"paragraph","inlineContent":[{"type":"text","text":"For models that only support the Converse API, use "},{"code":"StandardConverse","type":"codeVoice"},{"type":"text","text":":"}]},{"type":"codeListing","syntax":"swift","code":["extension BedrockModel {","    public static let new_bedrock_model = BedrockModel(","        id: \"family.model-id-v1:0\",","        name: \"New Model Name\",","        modality: StandardConverse(","            parameters: ConverseParameters(","                temperature: Parameter(.temperature, minValue: 0, maxValue: 1, defaultValue: 0.3),","                maxTokens: Parameter(.maxTokens, minValue: 1, maxValue: nil, defaultValue: nil),","                topP: Parameter(.topP, minValue: 0.01, maxValue: 0.99, defaultValue: 0.75),","                stopSequences: StopSequenceParams(maxSequences: nil, defaultValue: []),","                maxPromptSize: nil","            ),","            features: [.textGeneration, .systemPrompts, .document, .toolUse]","        )","    )","}"]},{"level":3,"type":"heading","anchor":"Converse-Features","text":"Converse Features"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Specify which features the model supports:"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"code":".textGeneration","type":"codeVoice"},{"text":" - Basic text generation","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"code":".systemPrompts","type":"codeVoice"},{"text":" - System message support","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"code":".vision","type":"codeVoice"},{"text":" - Image input processing","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"code":".document","type":"codeVoice"},{"text":" - Document input processing","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"code":".toolUse","type":"codeVoice"},{"text":" - Function calling","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"code":".streaming","type":"codeVoice"},{"text":" - Real-time response streaming","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"code":".reasoning","type":"codeVoice"},{"text":" - Reasoning output","type":"text"}],"type":"paragraph"}]}]},{"level":2,"type":"heading","anchor":"Adding-Text-Generation-Models","text":"Adding Text Generation Models"},{"type":"paragraph","inlineContent":[{"type":"text","text":"For models that need custom InvokeModel support, implement the required protocols:"}]},{"level":3,"type":"heading","anchor":"Step-1-Create-RequestResponse-Structures","text":"Step 1: Create Request\/Response Structures"},{"type":"codeListing","syntax":"swift","code":["public struct LlamaRequestBody: BedrockBodyCodable {","    let prompt: String","    let max_gen_len: Int","    let temperature: Double","    let top_p: Double","","    public init(prompt: String, maxTokens: Int = 512, temperature: Double = 0.5) {","        self.prompt = \"<|begin_of_text|><|start_header_id|>user<|end_header_id|>\\(prompt)<|eot_id|><|start_header_id|>assistant<|end_header_id|>\"","        self.max_gen_len = maxTokens","        self.temperature = temperature","        self.top_p = 0.9","    }","}","","struct LlamaResponseBody: ContainsTextCompletion {","    let generation: String","    let prompt_token_count: Int","    let generation_token_count: Int","    let stop_reason: String","","    public func getTextCompletion() throws -> TextCompletion {","        TextCompletion(generation)","    }","}"]},{"level":3,"type":"heading","anchor":"Step-2-Implement-TextModality","text":"Step 2: Implement TextModality"},{"type":"codeListing","syntax":"swift","code":["struct LlamaText: TextModality {","    let parameters: TextGenerationParameters","","    init(parameters: TextGenerationParameters) {","        self.parameters = parameters","    }","","    func getName() -> String { \"Llama Text Generation\" }","","    func getParameters() -> TextGenerationParameters {","        parameters","    }","","    func getTextRequestBody(","        prompt: String,","        maxTokens: Int?,","        temperature: Double?,","        topP: Double?,","        topK: Int?,","        stopSequences: [String]?","    ) throws -> BedrockBodyCodable {","        guard topK == nil else {","            throw BedrockLibraryError.notSupported(\"TopK is not supported for Llama\")","        }","        guard stopSequences == nil else {","            throw BedrockLibraryError.notSupported(\"Stop sequences not supported for Llama\")","        }","        ","        return LlamaRequestBody(","            prompt: prompt,","            maxTokens: maxTokens ?? parameters.maxTokens.defaultValue,","            temperature: temperature ?? parameters.temperature.defaultValue","        )","    }","","    func getTextResponseBody(from data: Data) throws -> ContainsTextCompletion {","        let decoder = JSONDecoder()","        return try decoder.decode(LlamaResponseBody.self, from: data)","    }","}"]},{"level":3,"type":"heading","anchor":"Step-3-Create-BedrockModel-Instance","text":"Step 3: Create BedrockModel Instance"},{"type":"codeListing","syntax":"swift","code":["extension BedrockModel {","    public static let llama3_3_70b_instruct: BedrockModel = BedrockModel(","        id: \"meta.llama3-3-70b-instruct-v1:0\",","        name: \"Llama 3.3 70B Instruct\",","        modality: LlamaText(","            parameters: TextGenerationParameters(","                temperature: Parameter(.temperature, minValue: 0, maxValue: 1, defaultValue: 0.5),","                maxTokens: Parameter(.maxTokens, minValue: 0, maxValue: 2_048, defaultValue: 512),","                topP: Parameter(.topP, minValue: 0, maxValue: 1, defaultValue: 0.9),","                topK: Parameter.notSupported(.topK),","                stopSequences: StopSequenceParams.notSupported(),","                maxPromptSize: nil","            )","        )","    )","}"]},{"level":2,"type":"heading","anchor":"Adding-Image-Generation-Models","text":"Adding Image Generation Models"},{"type":"paragraph","inlineContent":[{"type":"text","text":"For image generation models, implement "},{"code":"ImageModality","type":"codeVoice"},{"type":"text","text":":"}]},{"level":3,"type":"heading","anchor":"Step-1-Create-RequestResponse-Structures","text":"Step 1: Create Request\/Response Structures"},{"type":"codeListing","syntax":"swift","code":["public struct AmazonImageRequestBody: BedrockBodyCodable {","    let taskType: TaskType","    private let textToImageParams: TextToImageParams?","    private let imageGenerationConfig: ImageGenerationConfig","","    public static func textToImage(","        prompt: String,","        negativeText: String?,","        nrOfImages: Int?,","        cfgScale: Double?,","        seed: Int?,","        quality: ImageQuality?,","        resolution: ImageResolution?","    ) -> Self {","        \/\/ Implementation details...","    }","}","","struct AmazonImageResponseBody: ContainsImageGeneration {","    let images: [String]","    ","    func getImageGenerationOutput() throws -> ImageGenerationOutput {","        ImageGenerationOutput(images: images)","    }","}"]},{"level":3,"type":"heading","anchor":"Step-2-Implement-ImageModality","text":"Step 2: Implement ImageModality"},{"type":"codeListing","syntax":"swift","code":["struct AmazonImage: ImageModality {","    let parameters: ImageGenerationParameters","    ","    func getName() -> String { \"Amazon Image Generation\" }","    ","    func getImageGenerationParameters() -> ImageGenerationParameters {","        parameters","    }","    ","    func hasTextToImageModality() -> Bool { true }","    func hasImageVariationModality() -> Bool { false }","    ","    func getTextToImageRequestBody(\/* parameters *\/) throws -> BedrockBodyCodable {","        \/\/ Implementation...","    }","    ","    func getImageResponseBody(from data: Data) throws -> ContainsImageGeneration {","        let decoder = JSONDecoder()","        return try decoder.decode(AmazonImageResponseBody.self, from: data)","    }","}"]},{"level":2,"type":"heading","anchor":"Hybrid-Modalities","text":"Hybrid Modalities"},{"type":"paragraph","inlineContent":[{"type":"text","text":"For models supporting multiple capabilities, create custom modalities:"}]},{"type":"codeListing","syntax":"swift","code":["struct ModelFamilyModality: TextModality, ConverseModality {","    let parameters: TextGenerationParameters","    let converseFeatures: [ConverseFeature]","    let converseParameters: ConverseParameters","","    init(parameters: TextGenerationParameters, features: [ConverseFeature] = [.textGeneration]) {","        self.parameters = parameters","        self.converseFeatures = features","        self.converseParameters = ConverseParameters(textGenerationParameters: parameters)","    }","","    func getName() -> String { \"Model Family Text and Converse\" }","","    \/\/ Implement TextModality methods","    func getParameters() -> TextGenerationParameters { parameters }","    func getTextRequestBody(\/* ... *\/) throws -> BedrockBodyCodable { \/* ... *\/ }","    func getTextResponseBody(from data: Data) throws -> ContainsTextCompletion { \/* ... *\/ }","","    \/\/ Implement ConverseModality methods","    func getConverseParameters() -> ConverseParameters { converseParameters }","    func getConverseFeatures() -> [ConverseFeature] { converseFeatures }","}"]},{"level":2,"type":"heading","anchor":"Parameter-Validation","text":"Parameter Validation"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Define parameter constraints carefully:"}]},{"type":"codeListing","syntax":"swift","code":["\/\/ Supported parameter with range","Parameter(.temperature, minValue: 0.0, maxValue: 2.0, defaultValue: 1.0)","","\/\/ Supported parameter with no upper limit","Parameter(.maxTokens, minValue: 1, maxValue: nil, defaultValue: 1000)","","\/\/ Unsupported parameter","Parameter.notSupported(.topK)","","\/\/ Stop sequences with limits","StopSequenceParams(maxSequences: 4, defaultValue: [])","","\/\/ Stop sequences not supported","StopSequenceParams.notSupported()"]},{"level":2,"type":"heading","anchor":"Testing-New-Models","text":"Testing New Models"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Test your model implementation:"}]},{"type":"codeListing","syntax":"swift","code":["func testNewModel() async throws {","    let bedrock = try await BedrockService()","    let model = BedrockModel.new_bedrock_model","    ","    \/\/ Test basic functionality","    if model.hasTextModality() {","        let completion = try await bedrock.completeText(\"Hello\", with: model)","        print(\"Text completion: \\(completion.completion)\")","    }","    ","    if model.hasConverseModality() {","        let builder = try ConverseRequestBuilder(with: model)","            .withPrompt(\"Hello\")","        let reply = try await bedrock.converse(with: builder)","        print(\"Converse reply: \\(reply)\")","    }","    ","    \/\/ Test parameter validation","    do {","        let _ = try await bedrock.completeText(","            \"Test\", ","            with: model, ","            temperature: 5.0 \/\/ Should fail if max is < 5.0","        )","    } catch BedrockServiceError.parameterOutOfRange(let param, let value, let range) {","        print(\"Expected parameter error: \\(param) = \\(value) not in \\(range)\")","    }","}"]},{"level":2,"type":"heading","anchor":"Best-Practices","text":"Best Practices"},{"type":"orderedList","items":[{"content":[{"inlineContent":[{"inlineContent":[{"text":"Follow AWS Documentation","type":"text"}],"type":"strong"},{"text":": Check the official model documentation for exact request\/response formats","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"inlineContent":[{"text":"Validate Parameters","type":"text"}],"type":"strong"},{"text":": Implement proper parameter validation based on model capabilities","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"inlineContent":[{"text":"Handle Errors","type":"text"}],"type":"strong"},{"text":": Provide clear error messages for unsupported features","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"inlineContent":[{"text":"Test Thoroughly","type":"text"}],"type":"strong"},{"text":": Test all supported features and parameter combinations","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"inlineContent":[{"text":"Document Limitations","type":"text"}],"type":"strong"},{"text":": Clearly document what features are and arenâ€™t supported","type":"text"}],"type":"paragraph"}]}]}],"kind":"content"}],"kind":"article","metadata":{"role":"article","modules":[{"name":"BedrockService"}],"title":"Adding Models","roleHeading":"Article"},"abstract":[{"type":"text","text":"Extend BedrockService with new foundation models"}],"references":{"https://docs.aws.amazon.com/bedrock/latest/userguide/model-parameters.html":{"identifier":"https:\/\/docs.aws.amazon.com\/bedrock\/latest\/userguide\/model-parameters.html","url":"https:\/\/docs.aws.amazon.com\/bedrock\/latest\/userguide\/model-parameters.html","titleInlineContent":[{"type":"text","text":"AWS Bedrock Model Parameters"}],"type":"link","title":"AWS Bedrock Model Parameters"},"https://docs.aws.amazon.com/bedrock/latest/userguide/conversation-inference-supported-models-features.html":{"identifier":"https:\/\/docs.aws.amazon.com\/bedrock\/latest\/userguide\/conversation-inference-supported-models-features.html","url":"https:\/\/docs.aws.amazon.com\/bedrock\/latest\/userguide\/conversation-inference-supported-models-features.html","titleInlineContent":[{"type":"text","text":"Converse API Supported Features"}],"type":"link","title":"Converse API Supported Features"},"doc://BedrockService/documentation/BedrockService":{"type":"topic","title":"BedrockService","url":"\/documentation\/bedrockservice","identifier":"doc:\/\/BedrockService\/documentation\/BedrockService","role":"collection","images":[{"type":"icon","identifier":"bedrock.png"}],"kind":"symbol","abstract":[{"type":"text","text":"A Swift library for interacting with Amazon Bedrock foundation models"}]},"bedrock.png":{"identifier":"bedrock.png","alt":"BedrockService","variants":[{"url":"\/images\/BedrockService\/bedrock.png","traits":["1x","light"]}],"type":"image"}}}