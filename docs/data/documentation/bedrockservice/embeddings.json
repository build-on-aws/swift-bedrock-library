{"identifier":{"url":"doc:\/\/BedrockService\/documentation\/BedrockService\/Embeddings","interfaceLanguage":"swift"},"metadata":{"modules":[{"name":"BedrockService"}],"roleHeading":"Article","role":"article","title":"Embeddings"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/bedrockservice\/embeddings"]}],"sections":[],"kind":"article","hierarchy":{"paths":[["doc:\/\/BedrockService\/documentation\/BedrockService"]]},"primaryContentSections":[{"kind":"content","content":[{"level":2,"text":"Overview","anchor":"Overview","type":"heading"},{"inlineContent":[{"type":"text","text":"Embeddings convert text into numerical vector representations that capture semantic meaning. These vectors enable similarity comparisons, clustering, and retrieval-augmented generation (RAG) systems."}],"type":"paragraph"},{"level":2,"text":"Basic Embeddings","anchor":"Basic-Embeddings","type":"heading"},{"inlineContent":[{"type":"text","text":"Generate embeddings from text:"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["let model: BedrockModel = .titan_embed_text_v2","","guard model.hasEmbeddingsModality() else {","    throw MyError.incorrectModality(\"\\(model.name) does not support embeddings\")","}","","let embeddings = try await bedrock.embed(","    \"Swift is a powerful programming language\",","    with: model",")","","print(\"Generated embeddings with \\(embeddings.count) dimensions\")","print(\"First few values: \\(Array(embeddings.prefix(5)))\")"]},{"level":2,"text":"Vector Size Control","anchor":"Vector-Size-Control","type":"heading"},{"inlineContent":[{"type":"text","text":"Specify the embedding vector size:"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["let embeddings = try await bedrock.embed(","    \"Machine learning and artificial intelligence\",","    with: model,","    vectorSize: 512",")","","print(\"Embedding dimensions: \\(embeddings.count)\")"]},{"level":2,"text":"Semantic Similarity","anchor":"Semantic-Similarity","type":"heading"},{"inlineContent":[{"text":"Compare text similarity using embeddings:","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["let text1 = \"The cat sat on the mat\"","let text2 = \"A feline rested on the rug\"","let text3 = \"Quantum computing uses qubits\"","","let embedding1 = try await bedrock.embed(text1, with: model)","let embedding2 = try await bedrock.embed(text2, with: model)","let embedding3 = try await bedrock.embed(text3, with: model)","","\/\/ Calculate cosine similarity","func cosineSimilarity(_ a: [Double], _ b: [Double]) -> Double {","    let dotProduct = zip(a, b).map(*).reduce(0, +)","    let magnitudeA = sqrt(a.map { $0 * $0 }.reduce(0, +))","    let magnitudeB = sqrt(b.map { $0 * $0 }.reduce(0, +))","    return dotProduct \/ (magnitudeA * magnitudeB)","}","","let similarity12 = cosineSimilarity(embedding1, embedding2)","let similarity13 = cosineSimilarity(embedding1, embedding3)","","print(\"Similarity between text1 and text2: \\(similarity12)\")","print(\"Similarity between text1 and text3: \\(similarity13)\")","\/\/ text1 and text2 should have higher similarity than text1 and text3"]},{"level":2,"text":"Batch Processing","anchor":"Batch-Processing","type":"heading"},{"inlineContent":[{"text":"Process multiple texts efficiently:","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["let texts = [","    \"Apple is a technology company\",","    \"Bananas are yellow fruits\", ","    \"Microsoft develops software\",","    \"Oranges are citrus fruits\",","    \"Google creates search engines\"","]","","var embeddings: [[Double]] = []","","for text in texts {","    let embedding = try await bedrock.embed(text, with: model)","    embeddings.append(embedding)","}","","\/\/ Find most similar texts","func findMostSimilar(to queryIndex: Int, in embeddings: [[Double]]) -> Int {","    var maxSimilarity = -1.0","    var mostSimilarIndex = 0","    ","    for (index, embedding) in embeddings.enumerated() {","        guard index != queryIndex else { continue }","        ","        let similarity = cosineSimilarity(embeddings[queryIndex], embedding)","        if similarity > maxSimilarity {","            maxSimilarity = similarity","            mostSimilarIndex = index","        }","    }","    ","    return mostSimilarIndex","}","","let queryIndex = 0 \/\/ \"Apple is a technology company\"","let similarIndex = findMostSimilar(to: queryIndex, in: embeddings)","print(\"Most similar to '\\(texts[queryIndex])': '\\(texts[similarIndex])'\")"]},{"level":2,"text":"Document Retrieval System","anchor":"Document-Retrieval-System","type":"heading"},{"inlineContent":[{"text":"Build a simple RAG system:","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["struct Document {","    let id: String","    let content: String","    let embedding: [Double]","}","","class DocumentStore {","    private var documents: [Document] = []","    private let bedrock: BedrockService","    private let model: BedrockModel","    ","    init(bedrock: BedrockService, model: BedrockModel) {","        self.bedrock = bedrock","        self.model = model","    }","    ","    func addDocument(_ content: String, id: String) async throws {","        let embedding = try await bedrock.embed(content, with: model)","        let document = Document(id: id, content: content, embedding: embedding)","        documents.append(document)","    }","    ","    func search(_ query: String, topK: Int = 3) async throws -> [Document] {","        let queryEmbedding = try await bedrock.embed(query, with: model)","        ","        let similarities = documents.map { doc in","            (doc, cosineSimilarity(queryEmbedding, doc.embedding))","        }","        ","        return similarities","            .sorted { $0.1 > $1.1 }","            .prefix(topK)","            .map { $0.0 }","    }","}","","\/\/ Usage","let store = DocumentStore(bedrock: bedrock, model: model)","","try await store.addDocument(\"Swift is a programming language developed by Apple\", id: \"doc1\")","try await store.addDocument(\"Python is popular for data science and machine learning\", id: \"doc2\")","try await store.addDocument(\"JavaScript runs in web browsers and Node.js\", id: \"doc3\")","","let results = try await store.search(\"Apple programming language\")","for doc in results {","    print(\"Found: \\(doc.content)\")","}"]},{"level":2,"text":"Text Clustering","anchor":"Text-Clustering","type":"heading"},{"inlineContent":[{"text":"Group similar texts using embeddings:","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["struct TextCluster {","    let centroid: [Double]","    var texts: [String]","    var embeddings: [[Double]]","}","","func kMeansClustering(texts: [String], embeddings: [[Double]], k: Int, iterations: Int = 10) -> [TextCluster] {","    \/\/ Simple k-means implementation","    var clusters = Array(0..<k).map { _ in","        TextCluster(","            centroid: embeddings.randomElement()!,","            texts: [],","            embeddings: []","        )","    }","    ","    for _ in 0..<iterations {","        \/\/ Clear clusters","        for i in 0..<clusters.count {","            clusters[i].texts.removeAll()","            clusters[i].embeddings.removeAll()","        }","        ","        \/\/ Assign texts to nearest cluster","        for (textIndex, embedding) in embeddings.enumerated() {","            var minDistance = Double.infinity","            var nearestCluster = 0","            ","            for (clusterIndex, cluster) in clusters.enumerated() {","                let distance = 1.0 - cosineSimilarity(embedding, cluster.centroid)","                if distance < minDistance {","                    minDistance = distance","                    nearestCluster = clusterIndex","                }","            }","            ","            clusters[nearestCluster].texts.append(texts[textIndex])","            clusters[nearestCluster].embeddings.append(embedding)","        }","        ","        \/\/ Update centroids","        for i in 0..<clusters.count {","            if !clusters[i].embeddings.isEmpty {","                let dimensions = clusters[i].embeddings[0].count","                var newCentroid = Array(repeating: 0.0, count: dimensions)","                ","                for embedding in clusters[i].embeddings {","                    for j in 0..<dimensions {","                        newCentroid[j] += embedding[j]","                    }","                }","                ","                for j in 0..<dimensions {","                    newCentroid[j] \/= Double(clusters[i].embeddings.count)","                }","                ","                clusters[i] = TextCluster(","                    centroid: newCentroid,","                    texts: clusters[i].texts,","                    embeddings: clusters[i].embeddings","                )","            }","        }","    }","    ","    return clusters","}"]},{"level":2,"text":"Model Capabilities","anchor":"Model-Capabilities","type":"heading"},{"inlineContent":[{"text":"Check embedding model features:","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["if let embeddingModality = model.modality as? EmbeddingsModality {","    let params = embeddingModality.getEmbeddingsParameters()","    ","    if let vectorSizes = params.vectorSize.allowedValues {","        print(\"Supported vector sizes: \\(vectorSizes)\")","    }","    ","    print(\"Default vector size: \\(params.vectorSize.defaultValue)\")","}"]},{"level":2,"text":"Use Cases","anchor":"Use-Cases","type":"heading"},{"inlineContent":[{"text":"Embeddings are useful for:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Semantic Search"}]},{"type":"text","text":": Find documents similar to a query"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Recommendation Systems"}]},{"type":"text","text":": Suggest similar content"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Text Classification"}]},{"type":"text","text":": Group texts by topic"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Duplicate Detection"}]},{"type":"text","text":": Find similar or duplicate content"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"RAG Systems"}]},{"type":"text","text":": Retrieve relevant context for generation"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Clustering"}]},{"type":"text","text":": Organize large text collections"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Anomaly Detection"}]},{"type":"text","text":": Identify unusual text patterns"}]}]}],"type":"unorderedList"}]}],"abstract":[{"text":"Generate vector embeddings for semantic analysis","type":"text"}],"seeAlsoSections":[{"title":"Related Documentation","identifiers":["doc:\/\/BedrockService\/documentation\/BedrockService\/TextGeneration","doc:\/\/BedrockService\/documentation\/BedrockService\/Converse"],"anchor":"Related-Documentation"},{"title":"Core Features","identifiers":["doc:\/\/BedrockService\/documentation\/BedrockService\/Converse","doc:\/\/BedrockService\/documentation\/BedrockService\/ImageGeneration","doc:\/\/BedrockService\/documentation\/BedrockService\/TextGeneration"],"generated":true,"anchor":"Core-Features"}],"schemaVersion":{"major":0,"patch":0,"minor":3},"references":{"doc://BedrockService/documentation/BedrockService/Converse":{"url":"\/documentation\/bedrockservice\/converse","identifier":"doc:\/\/BedrockService\/documentation\/BedrockService\/Converse","abstract":[{"type":"text","text":"Build conversational AI applications with the Converse API"}],"type":"topic","role":"article","kind":"article","title":"Converse API"},"doc://BedrockService/documentation/BedrockService":{"type":"topic","title":"BedrockService","url":"\/documentation\/bedrockservice","identifier":"doc:\/\/BedrockService\/documentation\/BedrockService","role":"collection","images":[{"type":"icon","identifier":"bedrock.png"}],"kind":"symbol","abstract":[{"type":"text","text":"A Swift library for interacting with Amazon Bedrock foundation models"}]},"doc://BedrockService/documentation/BedrockService/TextGeneration":{"url":"\/documentation\/bedrockservice\/textgeneration","type":"topic","role":"article","identifier":"doc:\/\/BedrockService\/documentation\/BedrockService\/TextGeneration","title":"Text Generation","kind":"article","abstract":[{"type":"text","text":"Generate text using the InvokeModel API"}]},"bedrock.png":{"identifier":"bedrock.png","alt":"BedrockService","variants":[{"traits":["1x","light"],"url":"\/images\/BedrockService\/bedrock.png"}],"type":"image"},"doc://BedrockService/documentation/BedrockService/ImageGeneration":{"url":"\/documentation\/bedrockservice\/imagegeneration","type":"topic","role":"article","identifier":"doc:\/\/BedrockService\/documentation\/BedrockService\/ImageGeneration","title":"Image Generation","kind":"article","abstract":[{"type":"text","text":"Create and modify images with foundation models"}]}}}